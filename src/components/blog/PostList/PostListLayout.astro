---
import clsx from "clsx";
import LayoutKo from "~/layouts/LayoutKo.astro";
import NavigationMenu from "~/components/blog/NavigationMenu";
import PostList from "./PostList.astro";
import type { CollectionEntry } from "astro:content";

interface Props {
  listTitle: string;
  entries: CollectionEntry<"blog">[];
  activeTag?: string;
}

const { listTitle, entries, activeTag } = Astro.props;

const navMap = {
  "/blog": "전체보기",
  ...Object.fromEntries(
    ["Backend", "Frontend", "Infra", "Core V1", "Core V2"].map((tag) => [
      `/blog/tags/${encodeURIComponent(tag)}`,
      tag,
    ]),
  ),
};

const pathname = Astro.url.pathname.replace(/\/$/, "");
---

<LayoutKo title="PortOne 기술 블로그">
  <div class="max-w-1148px mx-auto my-4 flex min-h-full flex-col gap-10 px-5">
    <div class="z-10 flex flex-wrap items-end justify-between gap-x-6 gap-y-4">
      <h1 class="text-slate-8 text-8 lg:text-10 break-keep font-bold">
        <a href="/blog">PortOne 기술 블로그</a>
      </h1>
      <NavigationMenu
        client:visible
        activeTag={activeTag ?? navMap[pathname as keyof typeof navMap]}
        class="<sm:w-full <lg:ml-auto"
      >
        <ul
          class={clsx(
            "flex gap-x-5 overflow-x-auto whitespace-nowrap py-2",
            "lt-lg:(absolute top-full right-0 mt-1.5 flex-col rounded-md px-4 py-2 border bg-white shadow-lg)",
            "<sm:left-0",
          )}
        >
          {
            Object.entries(navMap).map(([path, tag]) => (
              <li
                class={clsx(
                  "text-1.125rem hover:text-slate-9 transition-colors duration-200",
                  "<lg:text-slate-9 <lg:hover:bg-slate-1 <lg:px-1 <lg:py-2 <lg:rounded-md <lg:flex <lg:items-center <lg:gap-3",
                  pathname === path
                    ? "lg:(text-slate-9 font-semibold)"
                    : "lg:text-slate-4",
                  path === "/blog" && "<lg:!hidden",
                )}
              >
                <i
                  class={clsx(
                    "i-ic-baseline-check inline-block lg:hidden",
                    pathname !== path && "invisible",
                  )}
                />
                <a href={path} class="block w-full">
                  {tag}
                </a>
              </li>
            ))
          }
        </ul>
      </NavigationMenu>
    </div>
    <div class="flex flex-col gap-6">
      <h2 class="text-slate-5 text-1.375rem <sm:hidden font-semibold">
        {listTitle}
      </h2>
      <PostList entries={entries} />
    </div>
  </div>
</LayoutKo>
