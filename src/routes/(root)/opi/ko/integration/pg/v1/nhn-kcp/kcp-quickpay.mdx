---
title: KCP 퀵페이 (자체 간편결제)
description: NHN KCP 퀵페이 결제 연동 방법을 안내합니다.
targetVersions: ["v1"]
---

import Details from "~/components/gitbook/Details";
import Tabs from "~/components/gitbook/Tabs";
import Hint from "~/components/Hint";
import Parameter from "~/components/parameter/Parameter";

## 채널 설정하기

[결제대행사 채널 설정하기](../../../../ready/readme#3-결제대행사-채널-설정하기)의 내용을 참고하여 PG 설정을 진행합니다.

## 퀵페이 (자체 간편 결제)

<Hint style="info">
  KCP 퀵페이를 연동하시는 경우 포트원 JavaScript SDK 1.2.0 이상의 버전을 사용해야 합니다.
</Hint>

### 가능한 결제 수단

- 카드 : `card`
- 즉시출금 : `trans`

### 퀵페이 호출하기

퀵페이의 경우 결제 기능을 포함하여 결제수단 등록 및 삭제, PIN 번호 변경 및 초기화, 탈퇴 기능을 지원합니다.

KCP 퀵페이 기준으로 작성한 예시 코드는 아래와 같습니다.

<Tabs>
  <Tabs.Tab title="결제수단 등록">
    ```ts
    IMP.request_pay(
      {
        channelKey: "{콘솔 내 연동 정보의 채널키}",
        pay_method: "card", //즉시 출금 이용 시 'trans' 입력
        merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
        name: "결제수단 등록테스트", //주문명
        amount: 0, //등록시 0으로 전달
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        customer_uid: "use_your_unique_id_with_pay_method_0", //결제 수단에 대한 고유 식별값
        bypass: {
          kcpQuick: {
            //KCP퀵페이 설정 정보
            actionType: "Register", //결제수단 등록
            encryptedCI: "encrypted_ci", // 본인인증 후 전달받은 CI를 암호화한 값
            memberID: "use_your_unique_id", //사용자에 대한 고유 식별값
          },
        },
        m_redirect_url: "https://testtest.test", //결제수단 등록 후 리디렉션될 URL
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```
  </Tabs.Tab>

  <Tabs.Tab title="결제수단 삭제">
    ```ts
    IMP.request_pay(
      {
        channelKey: "{콘솔 내 연동 정보의 채널키}",
        pay_method: "card", //즉시 출금 이용 시 'trans' 입력
        merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
        name: "결제수단 삭제테스트", //주문명
        amount: 0, //삭제시 0으로 전달
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        customer_uid: "use_your_unique_id_with_pay_method_0", //결제 수단에 대한 고유 식별값
        bypass: {
          kcpQuick: {
            //KCP퀵페이 설정 정보
            actionType: "Deregister", //결제수단 삭제
            encryptedCI: "encrypted_ci", // 본인인증 후 전달받은 CI를 암호화한 값
            memberID: "use_your_unique_id", //사용자에 대한 고유 식별값
          },
        },
        m_redirect_url: "https://testtest.test", //결제수단 등록 후 리디렉션될 URL
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```
  </Tabs.Tab>
</Tabs>

<Tabs>
  <Tabs.Tab title="결제 요청">
    ```ts
    IMP.request_pay(
      {
        channelKey: "{콘솔 내 연동 정보의 채널키}",
        pay_method: "card", //즉시 출금 이용 시 'trans' 입력
        merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
        name: "결제 테스트", //주문명
        amount: 1000,
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        customer_uid: "use_your_unique_id_with_pay_method_0", //결제 수단에 대한 고유 식별값
        bypass: {
          kcpQuick: {
            //KCP퀵페이 설정 정보
            actionType: "Pay", //결제 요청
            encryptedCI: "encrypted_ci", // 본인인증 후 전달받은 CI를 암호화한 값
            memberID: "use_your_unique_id", //사용자에 대한 고유 식별값
          },
        },
        m_redirect_url: "https://testtest.test", //결제수단 등록 후 리디렉션될 URL
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```
  </Tabs.Tab>
</Tabs>

<Tabs>
  <Tabs.Tab title="PIN번호 변경">
    ```ts
    IMP.request_pay(
      {
        channelKey: "{콘솔 내 연동 정보의 채널키}",
        pay_method: "card", //즉시 출금 이용 시 'trans' 입력
        merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
        name: "PIN번호 변경 테스트", //주문명
        amount: 0, //pin번호 변경시 0으로 전달
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        customer_uid: "use_your_unique_id", //memberId와 동일하게 입력
        bypass: {
          kcpQuick: {
            //KCP퀵페이 설정 정보
            actionType: "PinChange", //PIN번호 변경
            encryptedCI: "encrypted_ci", // 본인인증 후 전달받은 CI를 암호화한 값
            memberID: "use_your_unique_id", //사용자에 대한 고유 식별값
          },
        },
        m_redirect_url: "https://testtest.test", //결제수단 등록 후 리디렉션될 URL
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```
  </Tabs.Tab>

  <Tabs.Tab title="PIN번호 초기화">
    ```ts
    IMP.request_pay(
      {
        channelKey: "{콘솔 내 연동 정보의 채널키}",
        pay_method: "card", //즉시 출금 이용 시 'trans' 입력
        merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
        name: "PIN번호 초기화 테스트", //주문명
        amount: 0, //pin번호 초기화시 0으로 전달
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        customer_uid: "use_your_unique_id", //memberId와 동일하게 입력
        bypass: {
          kcpQuick: {
            //KCP퀵페이 설정 정보
            actionType: "PinReset", //PIN번호 초기화
            encryptedCI: "encrypted_ci", // 본인인증 후 전달받은 CI를 암호화한 값
            memberID: "use_your_unique_id", //사용자에 대한 고유 식별값
          },
        },
        m_redirect_url: "https://testtest.test", //결제수단 등록 후 리디렉션될 URL
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```
  </Tabs.Tab>
</Tabs>

<Tabs>
  <Tabs.Tab title="등록된 전화번호 변경">
    ```ts
    IMP.request_pay(
      {
        channelKey: "{콘솔 내 연동 정보의 채널키}",
        pay_method: "card", //즉시 출금 이용 시 'trans' 입력
        merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
        name: "전화번호 변경 테스트", //주문명
        amount: 0, //사용자만 등록시 0으로 전달
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        customer_uid: "use_your_unique_id", //memberId와 동일하게 입력
        bypass: {
          kcpQuick: {
            //KCP퀵페이 설정 정보
            actionType: "PhoneChange", //등록된 휴대폰 번호 변경
            encryptedCI: "encrypted_ci", // 본인인증 후 전달받은 CI를 암호화한 값
            memberID: "use_your_unique_id", //사용자에 대한 고유 식별값
          },
        },
        m_redirect_url: "https://testtest.test", //결제수단 등록 후 리디렉션될 URL
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```
  </Tabs.Tab>
</Tabs>

<Tabs>
  <Tabs.Tab title="해지">
    ```ts
    IMP.request_pay(
      {
        channelKey: "{콘솔 내 연동 정보의 채널키}",
        pay_method: "card", //즉시 출금 이용 시 'trans' 입력
        merchant_uid: "order_no_0001", //상점에서 생성한 고유 주문번호
        name: "해지 테스트", //주문명
        amount: 0, //해지시 0으로 전달
        buyer_email: "test@portone.io",
        buyer_name: "구매자이름",
        buyer_tel: "010-1234-5678",
        buyer_addr: "서울특별시 강남구 삼성동",
        buyer_postcode: "123-456",
        customer_uid: "use_your_unique_id", //memberId와 동일하게 입력
        bypass: {
          kcpQuick: {
            //KCP퀵페이 설정 정보
            actionType: "Terminate", //유저 및 결제수단 삭제
            encryptedCI: "encrypted_ci", // 본인인증 후 전달받은 CI를 암호화한 값
            memberID: "use_your_unique_id", //사용자에 대한 고유 식별값
          },
        },
        m_redirect_url: "https://testtest.test", //결제수단 등록 후 리디렉션될 URL
      },
      function (rsp) {
        // callback 로직
        //* ...중략... *//
      },
    );
    ```
  </Tabs.Tab>
</Tabs>

<Hint style="info">
  퀵페이의 경우 m\_redirect\_url시 다음과 같이 4개의 파라미터가 Query String으로 전달됩니다.

  - `imp_uid`
  - `merchant_uid`
  - `imp_status` : true 또는 false
  - `kcp_action` : Register 또는 Dregister 또는 Pay

  `kcp_action`이 Register 이고 `imp_status`가 true인 경우 결제수단 등록에 성공하였다는 것을 의미합니다.
</Hint>

#### 주요 파라미터

<Parameter flatten>
  - channelKey: string

    **채널키**

    결제를 진행할 채널을 지정합니다.

    포트원 콘솔 내 \[결제 연동] - \[연동 정보] - \[채널 관리] 에서 확인 가능합니다.

    (최신 JavaScript SDK 버전부터 사용 가능합니다.)

  - pg(deprecated)?: string

    **PG사 구분코드**

    포트원 콘솔 내 \[연동 관리] > \[연동 정보] > \[채널 관리] 화면에서 채널 추가 후
    `kcp_quick.{mid(사이트코드)}` 형식으로 채널을 지정할 때 사용됩니다.

    <Hint style="warning">
      `pg` 파라미터는 지원 중단 예정입니다.

      JS SDK를 가장 최신 버전으로 업그레이드 후 `channelKey` 파라미터로 채널 설정(PG사 구분)을 대체해주세요.
    </Hint>

  - pay\_method: string

    **결제수단 구분코드**

    결제 호출 시 결제수단을 지정할 때 사용됩니다.

    - card (카드)
    - trans (즉시출금)

  - merchant\_uid: string

    **고객사 주문 고유 번호**

    고객사에서 채번하는 주문 고유 번호로 매번 고유하게 채번되어야 합니다.

  - amount: integer

    **결제금액**

  - customer\_uid: string

    **결제 수단에 대한 고유 식별값**

    퀵페이에 등록된 결제수단과 1:1 맵핑됩니다.

  - bypass?: oneof object

    **PG사 결제창 호출 시 PG사로 그대로 bypass할 파라미터들의 모음**

    <Parameter.Details>
      - kcpQuick?: object

        **KCP 퀵페이 설정정보**

        퀵페이 결제시 필수로 입력해야 합니다.

        <Parameter.Details>
          - actionType: string

            **호출 유형**

            - Register : 결제 수단 등록
            - Deregister : 결제 수단 삭제
            - Pay : 결제
            - PinChange : PIN번호 변경
            - PinReset : PIN번호 초기화
            - PhoneChange : 전화번호 변경
            - Terminate : 결제 수단 해지

          - encryptedCI: string

            **암호화된 본인인증 CI**

          - memberID: string

            **사용자 식별값**

            최대 16byte까지 입력가능하며, 고객이 여러개의 결제수단을 등록하는 경우 동일한 `memberID`를 입력해야 합니다.

          - deviceID?: string

            **디바이스 식별값**

            미 입력시 고객이 사용한 브라우저 정보가 입력됩니다.

          - noAuth?: boolean

            **무인증 등록/결제 여부**

            `true`로 입력한 경우 무인증 키가 발급되며, 이후 결제시 PIN번호 인증 과정이 생략됩니다.

            - true : 무인증 결제
            - false : 인증 결제

          - installment?: number

            **할부 개월수**

            입력하지 않는 경우 일시불로 진행됩니다.

          - useCardPoint?: boolean

            **카드사 포인트 결제 여부**

            입력하지 않는 경우 미사용으로 진행됩니다.

            - true : 카드사 포인트 사용
            - false : 카드사 포인트 미사용
        </Parameter.Details>
    </Parameter.Details>
</Parameter>

#### 유의사항

<Details>
  <Details.Summary>`customer_uid` 파라미터 안내</Details.Summary>

  <Details.Content>
    결제수단 등록/삭제, 결제 요청시에는 결제수단을 식별하는 `customer_uid`를 입력한 후 사용해야 합니다.
    이 외의 PIN번호 변경/확인/초기화, 사용자 등록, 해지 요청시에는 `customer_uid`에 결제수단 등록시 입력한 `memberID`를 입력해야 합니다.
    위의 경우에 `customer_uid` 파라미터에 발급시 입력했던 `customer_uid`를 입력하는 경우 에러가 리턴됩니다.
  </Details.Content>
</Details>

<Details>
  <Details.Summary>`encryptedCI` 파라미터 안내</Details.Summary>

  <Details.Content>
    본인인증 후 전달받은 CI 값을 아래 방법으로 암호화하여 입력해야합니다.

    포트원 계정의 [REST API Secret](/api/rest-v1/auth?v=v1) 을 SHA-256 해시 알고리즘으로 처리하여 암호화 키를 생성한 후, 해당 키를 사용해 CI 데이터를 AES-256-ECB 방식으로 암호화해야 합니다.
    암호화된 결과는 Base64로 인코딩하여 encryptedCI 파라미터 값으로 전달합니다.

    ```pseudo
    FUNCTION encryptCi(ci, apiSecret):
    # Step 1: SHA-256으로 API Secret을 해시하여 암호화 키 생성
    key = SHA256(apiSecret)

    # Step 2: AES-256-ECB 알고리즘으로 CI 데이터를 암호화
    encryptedData = AES256Encrypt(data = ci, key = key, mode = ECB)

    # Step 3: 암호화된 데이터를 Base64로 인코딩
    base64EncodedData = Base64Encode(encryptedData)

    # Step 4: Base64 인코딩된 결과 반환
    RETURN base64EncodedData
    END FUNCTION
    ```
  </Details.Content>
</Details>

<Details>
  <Details.Summary>결제수단을 여러개 등록할 수 있습니다.</Details.Summary>

  <Details.Content>
    한 고객에게 여러개의 결제수단을 등록할 수 있습니다.
    고객 식별 정보(`memberID`)와 결제 수단 식별 정보(`customer_uid`)의 경우 1:N으로 맵핑되며,
    이미 등록한 고객의 `memberID`를 동일하게 입력한 후 사용하지 않은 `customer_uid`를 지정하는 경우 여러개의 결제 수단을 등록할 수 있습니다.
  </Details.Content>
</Details>

<Details>
  <Details.Summary>결제수단 삭제 요청시 등록할 때 입력한 정보를 동일하게 입력해야 합니다.</Details.Summary>

  <Details.Content>
    결제수단 삭제(actionType:Deregister) 요청시 결제수단 등록할 때 사용된 `customer_uid` + `encryptedCI` + `memberID` + `deviceID` + `noAuth` 조합을
    동일하게 전송해야 합니다.
  </Details.Content>
</Details>

<Details>
  <Details.Summary>PIN번호 초기화 시 기존에 등록된 모든 결제수단이 삭제됩니다.</Details.Summary>

  <Details.Content>
    핀번호 초기화 시 기존에 등록된 모든 결제수단이 삭제됩니다. 이에 따라 고객사에서는 `customer_uid`로 저장된 데이터를 일괄 삭제해야 합니다.
    핀번호 초기화 이후 [빌링키 삭제 API](/api/rest-v1/billingkey?v=v1#delete%20%2Fsubscribe%2Fcustomers%2F%7Bcustomer_uid%7D)를 이용하여 일괄 삭제할 수 있습니다.
    만약 핀번호 초기화 전에 삭제를 시도하는 경우 에러 메시지와 함께 삭제가 불가능합니다.
  </Details.Content>
</Details>

<Details>
  <Details.Summary>등록된 전화번호 변경 기능은 사전 협의 후 사용 가능합니다.</Details.Summary>

  <Details.Content>
    전화 번호 변경(actionType:PhoneChange)은 퀵페이에 등록된 전화번호를 변경할 수 있는 기능입니다.
    해당 기능 사용을 원하시는 경우 KCP와 사전에 협의가 필요합니다.
  </Details.Content>
</Details>

<Details>
  <Details.Summary>결제 시 등록된 결제수단 화면을 표시할 수 있습니다.</Details.Summary>

  <Details.Content>
    결제(actionType:Pay)시 `customer_uid`를 빈 값 또는 생략한 경우 등록된 결제수단을 선택하는 화면이 표시됩니다.
  </Details.Content>
</Details>

<Details>
  <Details.Summary>결제 금액이 30만원 이상인 경우 ARS 인증이 진행됩니다.</Details.Summary>

  <Details.Content>
    결제 금액이 30만원 이상인 경우 ARS 인증이 진행되며, 퀵페이 등록시 입력된 전화 번호로 전화가 갑니다.
  </Details.Content>
</Details>

<Details>
  <Details.Summary>퀵페이 해지 안내 </Details.Summary>

  <Details.Content>
    해지(actionType:Terminate)시
    [빌링키 삭제 API](/api/rest-v1/billingkey?v=v1#delete%20%2Fsubscribe%2Fcustomers%2F%7Bcustomer_uid%7D)를 이용하여 등록되어 있던 결제수단을 일괄 삭제해야 합니다.
  </Details.Content>
</Details>

<Details>
  <Details.Summary>무인증 결제 안내</Details.Summary>

  <Details.Content>
    결제 수단 등록, PIN번호 체크시 `noAuth:true` 파라미터를 추가하여 요청한 경우 무인증 등록이 가능합니다.
    등록 이후 결제 요청하는 경우 무인증 결제를 이용할 수 있습니다. 무인증 결제시 PIN번호 입력 과정이 생략되며,
    바로 결제과 진행됩니다.

    만약 무인증 등록과정 없이 무인증 결제가 요청되는 경우 PIN번호 입력 화면이 표시되고, 올바른 PIN번호 입력시 무인증 등록 및 결제가 진행됩니다.
  </Details.Content>
</Details>
