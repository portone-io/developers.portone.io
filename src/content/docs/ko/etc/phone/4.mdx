---
emoji: ğŸ¤¹
title: 4. ì¸ì¦ì •ë³´ ì¡°íšŒ ë° í™œìš©í•˜ê¸°
description: ì¸ì¦ì •ë³´ë¥¼ íšë“í•˜ê³  í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.
---

import * as prose from "~/components/prose";
export const components = prose;

import Hint from "~/components/gitbook/Hint.astro";
import Tabs from "~/components/gitbook/tabs/Tabs.astro";
import Tab from "~/components/gitbook/tabs/Tab.astro";


íœ´ëŒ€í° ë³¸ì¸ì¸ì¦ ì™„ë£Œì´í›„ íšë“í•œ `imp_uid`ë¥¼ ì´ìš©í•˜ì—¬ ê³ ê° ì¸ì¦ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### <mark style="color:blue;">**STEP 01.**</mark> ì¸ì¦ì •ë³´(imp\_uid) ì„œë²„ë‹¨ì—ì„œ íšë“í•˜ê¸°

ì•„ë˜ëŠ” íœ´ëŒ€í° ë³¸ì¸ì¸ì¦ ì•ë‹¨ì—ì„œ ë„˜ì–´ì˜¨ ê°’ì„ ì„œë²„ë‹¨ì—ì„œ ìˆ˜ì‹ ë°›ì€ ì˜ˆì œ ì…ë‹ˆë‹¤.

<Tabs>
<Tab title="Node.js(íŒì—…ë°©ì‹)">
```javascript title="server-side"
app.use(bodyParser.json());
  ...
  // "/certifications"ì— ëŒ€í•œ POST ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” controller
  app.post("/certifications", async (request, response) => {
    // requestì˜ bodyì—ì„œ imp_uid ì¶”ì¶œ
    const { imp_uid } = request.body; 
})
```


</Tab>

<Tab title="Node.js(ë¦¬ë””ë ‰ì…˜ ë°©ì‹)">
```javascript title="server-side"
app.use(bodyParser.json());
  ...
  // "/certifications/redirect"ì— ëŒ€í•œ GET ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” controller
  app.get("/certifications/redirect", async (request, response) => {
    const { imp_uid } = request.query; // requestì˜ queryì—ì„œ imp_uid ì¶”ì¶œ
})
```


</Tab>
</Tabs>

### <mark style="color:blue;">**STEP 02.**</mark> ì¸ì¦ ì •ë³´ ì¡°íšŒí•˜ê¸°

í¬íŠ¸ì› ì„œë²„ì—ì„œ ì¸ì¦ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ì„œ ë¨¼ì € [**REST API access token**](../../api/rest-api-access-token.md)ì„ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤. ë°œê¸‰ë°›ì€ ì•¡ì„¸ìŠ¤ í† í°(`access_token`)ê³¼ ì¸ì¦ë²ˆí˜¸(`imp_uid`)ë¡œ <mark style="color:blue;">**ë³¸ì¸ì¸ì¦ ê²°ê³¼ì¡°íšŒ REST API**</mark> ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¸ì¦ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.

```javascript title="server-side"
app.use(bodyParser.json());
  ...
  // "/certifications"ì— ëŒ€í•œ POST ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” controller
  app.post("/certifications", async (request, response) => {
    const { imp_uid } = request.body; // requestì˜ bodyì—ì„œ imp_uid ì¶”ì¶œ
    try {
      // ì¸ì¦ í† í° ë°œê¸‰ ë°›ê¸°
      const getToken = await axios({
        url: "https://api.iamport.kr/users/getToken",
        // POST method
        method: "post", 
        // "Content-Type": "application/json"
        headers: { "Content-Type": "application/json" }, 
        data: {
          imp_key: "imp_apikey", // REST APIí‚¤
          imp_secret: "ekKoeW8RyKuT0zgaZsUtXXTLQ4AhPFW3ZGseDA6bkA5lamv9OqDMnxyeB9wqOsuO9W3Mx9YSJ4dTqJ3f" // REST API Secret
        }
      });
      const { access_token } = getToken.data; // ì¸ì¦ í† í°
      ...
      // imp_uidë¡œ ì¸ì¦ ì •ë³´ ì¡°íšŒ
      const getCertifications = await axios({
        // imp_uid ì „ë‹¬
        url: \`https://api.iamport.kr/certifications/\${imp_uid}\`, 
        // GET method
        method: "get", 
        // ì¸ì¦ í† í° Authorization headerì— ì¶”ê°€
        headers: { "Authorization": access_token } 
      });
      const certificationsInfo = getCertifications.data; // ì¡°íšŒí•œ ì¸ì¦ ì •ë³´
      ...
    } catch(e) {
      console.error(e);
    }
  });
```


### <mark style="color:blue;">**STEP 03.**</mark> ì¸ì¦ ì •ë³´ í™œìš©í•˜ê¸°

ì¡°íšŒí•œ ì¸ì¦ ì •ë³´ì—ì„œ ë‹¤ìŒì˜ ê³ ê° ì •ë³´ë¥¼ ì¶”ì¶œí•˜ëŠ” ì„œë¹„ìŠ¤ ì½”ë“œ ì˜ˆì œì…ë‹ˆë‹¤.

* `name`: ì´ë¦„
* `gender`: ì„±ë³„
* `birth`: ìƒë…„ì›”ì¼
* `unique_key`: CI ê°’ê³¼ ë™ì¼. ì˜¨ë¼ì¸ ì£¼ë¯¼ë²ˆí˜¸ì™€ ê°™ì€ ê°œì¸ê³ ìœ ì‹ë³„í‚¤
* `unique_in_site`: DI ê°’ê³¼ ë™ì¼. ìƒì ì•„ì´ë””(ì‚¬ì´íŠ¸)ë³„ë¡œ í• ë‹¹ë˜ëŠ” ì‹ë³„í‚¤

<Hint style="info">
ìœ„ì˜ ì •ë³´ ì™¸ì— íœ´ëŒ€í° ë²ˆí˜¸(**`phone`**) ë° í†µì‹ ì‚¬(**`carrier`**) ë˜ëŠ” ì™¸êµ­ì¸(**`foreigner`**) ì—¬ë¶€ëŠ” **ê°œì¸ì •ë³´ ì œê³µë™ì˜ ì•½ê´€ì„ ì‚¬ì´íŠ¸ì— ê²Œì¬**í•œ í›„ <mark style="color:red;">**cs@portone.io**</mark>**ë¡œ ì‹ ì²­**í•˜ì—¬ ì·¨ë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ë¶€ë¶„ì€ ë‹¹ì‚¬ ê³„ì•½ ì´í›„ ë‹¤ë‚ PGì‚¬ë¡œ ìš”ì²­ í›„ ìŠ¹ì¸ì´ ì™„ë£Œë˜ë©´ ì´ìš© ê°€ëŠ¥í•œ ì  ì°¸ê³ í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

**ë©”ì¼ ìš”ì²­ ì‹ ì²­ ì–‘ì‹**

* ìƒí˜¸ëª… :
* ì‚¬ì—…ìë²ˆí˜¸ :
* ë³¸ì¸ì¸ì¦ìš© ë‹¤ë‚  ìƒì ID(CPID) :
* ì—…ì¢… :
* í•„ìš”ì‚¬ìœ  :
* ê°œì¸ì •ë³´ì·¨ê¸‰ë°©ì¹¨ url : ì•±ì„œë¹„ìŠ¤ë¡œ URLí˜•íƒœë¡œ ì „ë‹¬ì´ ì–´ë ¤ìš°ì‹  ê²½ìš° 'ê°œì¸ì •ë³´ì·¨ê¸‰ë°©ì¹¨' ê²½ë¡œë¥¼ ìº¡ì³í•˜ì—¬ ì „ë‹¬ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

**ì°¸ê³  - í¬íŠ¸ì› ì´ìš© ê°€ë§¹ì ì˜ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ì ìš© ì˜ˆì‹œ**

* `(ì£¼)ë§ˆí”Œ : https://marpple.shop/kr/@/privacy`
* `(ì£¼)ë¸Œë ˆì´ë¸Œëª¨ë°”ì¼ / ìˆ¨ê³  : https://soomgo.com/terms/privacy`
* `(ì£¼)ë§ˆì¼“ì‡ : https://static.marketit.asia/static/privacy-terms.pdf`

</Hint>

```javascript title="Node.js"
// "/certifications"ì— ëŒ€í•œ POST ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” controller
  app.post("/certifications", async (request, response) => {
    const { imp_uid } = request.body; // requestì˜ bodyì—ì„œ imp_uid ì¶”ì¶œ
    try {
      // ì¸ì¦ í† í° ë°œê¸‰ ë°›ê¸°
      /* ...ì¤‘ëµ... */
      // imp_uidë¡œ ì¸ì¦ ì •ë³´ ì¡°íšŒ
      /* ...ì¤‘ëµ... */
      const certificationsInfo = getCertifications.data; // ì¡°íšŒí•œ ì¸ì¦ ì •ë³´
      // unique_key: ê°œì¸ì‹ë³„ ê³ ìœ  í‚¤, unique_in_site: ì‚¬ì´íŠ¸ ë³„ ê°œì¸ì‹ë³„ ê³ ìœ  í‚¤
      const { unique_key, unique_in_site, name, gender, birth } = certificationsInfo;
      ...
      // ì—°ë ¹ ì œí•œ ë¡œì§
      if (new Date(birth).getFullYear() <= 1999) {
        // ì—°ë ¹ ë§Œì¡±
      } else {
        // ì—°ë ¹ ë¯¸ë‹¬
      }
      ...
      // 1ì¸ 1ê³„ì • í—ˆìš© ë¡œì§
      // DBì—ì„œ unique_key ì¡°íšŒ í›„ ê°€ì…ì—¬ë¶€ ê²€ì‚¬
      Users.find({ certificationKey: unique_key })
      .then((user) => {
        if (!user) {
          // ì‹ ê·œ ê³ ê°
        } else {
          // ì´ë¯¸ ê°€ì…ëœ ê³ ê°
        }
      });
    } catch(e) {
      console.error(e);
    }
  });
```

