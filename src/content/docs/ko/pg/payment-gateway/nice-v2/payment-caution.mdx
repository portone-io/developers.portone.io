---
emoji: 📍
title: 일반결제 연동 유의사항
description: (신)나이스페이 일반결제 연동 유의사항을 소개합니다.
---

import * as prose from "~/components/prose";
export const components = prose;

import Details from "~/components/gitbook/Details.astro";
import Figure from "~/components/gitbook/Figure.astro";

### 결제창 호출 실패 사유 알 수 없음

상점 아이디 설정 이슈, 파라미터 설정 오류 등으로 결제창 호출이 안 될 수 있는데 이때 정확한 사유를 나이스에서 알려주지 않기 때문에 실패 사유가 “알 수 없는 이유로 결제가 중단되었습니다. 나이스페이로 문의(1661-0808)하세요.”라고 리턴됩니다. 이 메시지를 받으신 경우 결제창 호출을 시도하신 파라미터 전문과 함께 포트원으로 문의주시면 상세 사유를 알려드리겠습니다.

# 카드 결제

| 기능                                  | 사용 가능 여부                                            |
| ------------------------------------- | --------------------------------------------------------- |
| 상점 부담 무이자 할부                 | 가능                                                      |
| 다이렉트 호출                         | `단독 사용 불가능(고정 할부 개월수가 함께 전달 되어야 함` |
| 다이렉트 호출 + 고정 할부 개월수      | 가능                                                      |
| 다이렉트 호출 + 리스트 할부 개월수    | `불가능`                                                  |
| 비 다이렉트 호출 + 고정 할부 개월수   | `PC만 가능`                                               |
| 비 다이렉트 호출 + 리스트 할부 개월수 | `PC만 가능`                                               |

### 토스뱅크 카드는 카드사 다이렉트 호출 불가능

나이스페이 V2는 토스뱅크 카드(card.direct.code = "092") 다이렉트 호출을 지원하지 않습니다.

### 카드사 다이렉트 호출시 고정 할부 개월수는 필수 입력

나이스페이 V2는 **카드사 다이렉트 호출시 고정 할부 개월수를 필수로 입력**해야 합니다. 심지어 결제 금액이 할부 지원 금액 미만(대개 50,000원)인 경우여도 할부 개월수를 0(일시불)으로 전달해야 합니다.

<Details>
<p slot="summary">BC 카드 다이렉트 호출 + 5개월 고정 할부</p>

```javascript
IMP.request_pay({
  ...중략
  pg: 'nice_v2',
  pay_method: 'card',
  card: {
    direct: {
      // 다이렉트 호출 할 카드사 코드와 고정 할부 개월수를 모두 지정해야 함
      code: '361' // BC카드
      quota: 5, // 5개월 할부
    }
  }
}, 콜백함수);
```

</Details>

<Details>
<p slot="summary">삼성 카드 다이렉트 호출 + 일시불</p>

```javascript
IMP.request_pay({
  ...중략
  pg: 'nice_v2',
  pay_method: 'card',
  card: {
    direct: {
      // 다이렉트 호출 할 카드사 코드와 고정 할부 개월수를 모두 지정해야 함
      code: '365' // 삼성카드
      quota: 0, // 일시불
    }
  }
}, 콜백함수);
```

</Details>

### 모바일 환경에서는 다이렉트 호출시에만 할부 옵션 설정 가능

나이스페이 V2 일반 카드 결제시(간편결제 제외) 할부 옵션(고정 할부 개월수)를 전달할 수 있는데요, **모바일 환경**에서는 **카드사 다이렉트 호출일때만 할부 옵션을 전달할 수 있습니다.** 만약 모바일 환경에서 다이렉트 호출 할 카드사 코드 없이 할부 옵션을 전달하는 경우 무시됩니다.

<Details>
<p slot="summary">모바일 환경에서 리스트 할부 개월수만 전달 → 전달한 파라미터가 무시되고 모든 할부 개월수 렌더링</p>

```javascript
IMP.request_pay({
  ...중략
  pg: 'nice_v2',
  pay_method: 'card',
  display: { card_quota: [2,3,4,5,6] }, // 2 ~ 6 개월 리스트 할부 개월수 적용 시도
}, 콜백함수);
```

import screenshot1 from "./_assets/caution/only-list-installment-on-mobile.png";

<Figure src={screenshot1} />

</Details>

<Details>
<p slot="summary">모바일 환경에서 3개월 고정 할부 개월수만 전달 → 전달한 파라미터가 무시되고 모든 할부 개월수 렌더링</p>

```javascript
...중략
IMP.request_pay({
  pg: 'nice_v2',
  pay_method: 'card',
  display: { card_quota: [3] }, // 3개월 고정 할부 개월수 적용 시도
}, 콜백함수);
```

<Figure src={screenshot1} />

</Details>

# 가상계좌

### 가상계좌 입금 기한(`vbank_due`)은 필수 입력

나이스페이 V2 가상계좌 발급시, 입금 기한은 필수 입력이며 아래 4가지 형식만 유효합니다. 입금 기한을 입력하지 않거나, 유효하지 않은 형식을 입력할 경우 나이스페이 V2 가상계좌 발급시 유효한 입금 기한을 필수로 입력해야 합니다. 라는 에러 메시지가 뜨면서 가상계좌 발급 창이 호출되지 않으니 유의하시기 바랍니다.

- YYYY-MM-DD HH:mm:ss
- YYYYMMDDHHmmss
- YYYY-MM-DD
- YYYYMMDD

# 계좌이체

### 계좌이체 다이렉트 호출시 은행 코드 지정 불가능

나이스페이 V2 계좌이체 다이렉트 호출은 은행 코드를 지정해 해당 은행 결제창이 바로 뜨는 방식이 아니고 단순히 나이스페이 결제창을 건너뛰고 바로 뱅크페이 결제창이 띄워지는 구조입니다.

### 계좌이체 다이렉트 호출시 현금영수증 정보는 필수 입력

계좌이체 거래는 계좌에서 현금이 바로 빠져나가는 방식이기 때문에 현금영수증 발급이 가능하므로 현금영수증 정보는 필수 입력입니다. 만약 입력하지 않을 경우 나이스페이 V2 계좌이체 다이렉트 호출시 **현금영수증 발급 유형은 필수 입력**입니다.라는 에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.

### 계좌이체 에스크로 결제시에는 다이렉트 호출 불가능

나이스페이 정책상 계좌이체 + 에스크로 결제시에는 다이렉트 호출이 불가능합니다. 아래와 같이 계좌이체 + 에스크로 + 다이렉트 호출을 위한 파라미터를 설정할 경우 "나이스페이 V2 계좌이체 에스크로 결제시 다이렉트 호출은 불가능합니다."라는 에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.

### 계좌이체 에스크로 결제시 결제창에 올바른 이메일을 입력해야 함

존재하지 않는 이메일을 입력할 경우 **이메일 주소 오류**라는 에러 메시지와 함께 승인에 실패합니다. 또한 나이스페이 측 기준 (실제로 존재하지만) 유효하지 않다고 취급하는 이메일 주소(예) .finance로 끝나는 이메일 주소)를 입력한 경우 승인은 정상적으로 되지만 **이후 API로 에스크로 등록시 에스크로 구매 확정 이메일이 전송되지 않습니다.** 이는 나이스페이 내부적으로 특정 이메일 주소가 유효하지 않다고 판단하기 때문이며 포트원과는 무관한 이슈입니다.

<Details>
<p slot="summary">자세히 보기</p>

```javascript
IMP.request_pay({
  ...중략
  pg: 'nice_v2',
  pay_method: 'trans', // 계좌이체 결제
  escrow: true, // 에스크로 결제
}, 콜백함수);
```

import screenshot2 from "./_assets/caution/escrow-trans.png";

<Figure src={screenshot2} />

</Details>

# 휴대폰 소액결제

### 실물/컨텐츠 여부(`digital`) 필수 입력

휴대폰 소액결제시 실물/컨텐츠 여부(digital) 파라미터는 필수 입력입니다. 입력하지 않는 경우 "나이스페이 V2 휴대폰 소액결제시 상품 유형 파라미터는 필수 입력입니다." 라는 에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.

| digital | 의미   |
| ------- | ------ |
| true    | 컨텐츠 |
| false   | 실물   |

또한 상점 아이디 설정과 실물/컨텐츠 여부가 불일치할 경우 "CPID 설정 오류"라는 메시지가 리턴되며 결제창 호출에 실패하니 유념하시기 바랍니다.

# 상품권 결제

### 컬쳐랜드(`cultureland`)만 지원

나이스페이는 상품권 결제시 컬쳐랜드만 지원하며 북앤라이프, 스마트문상, 해피머니 등은 지원하지 않습니다.

### MallUserID(`bypass.nice_v2.MallUserID`)는 필수 입력

나이스페이 상품권 결제시 가맹점 구매자 ID를 의미하는 MalluserID는 필수 입력이며, bypass 파라미터로 전달할 수 있습니다.

### 승인 완료시 나이스페이로부터 승인번호(`apply_num`)가 전달되지 않음

나이스페이는 카드 결제시에만 승인 번호를 전달해주기 때문에 상품권 결제시에는 승인 번호가 전달되지 않습니다. 따라서 결제 내역 조회시 승인 번호는 null로 리턴됩니다.

<Details>
<p slot="summary">결제내역 조회 API 호출 결과</p>

```javascript
// GET /payments/{imp_uid}
{
	...중략
	status: 'paid',
	pay_method: 'cultureland',
	pg: 'nice_v2',
	apply_num: null
}
```

</Details>

# 카카오페이

| 기능                                  | 사용 가능 여부                                                      |
| ------------------------------------- | ------------------------------------------------------------------- |
| 상점 부담 무이자 할부                 | `불가능`                                                            |
| 다이렉트 호출                         | BC, 국민, 삼성, 신한, 현대, 롯데, 씨티, NH 그리고 하나 카드만 가능  |
| 다이렉트 호출 + 고정 할부 개월수      | BC, 국민, 삼성, 신한, 현대, 롯데, 씨티, NH 그리고 하나 카드만 가능  |
| 다이렉트 호출 + 리스트 할부 개월수    | `불가능`                                                            |
| 비 다이렉트 호출 + 고정 할부 개월수   | `단독 사용 불가능(다이렉트 호출 할 카드사 코드를 함께 전달해야 함)` |
| 비 다이렉트 호출 + 리스트 할부 개월수 | `불가능`                                                            |

# 네이버페이

| 기능                                  | 사용 가능 여부                                                      |
| ------------------------------------- | ------------------------------------------------------------------- |
| 상점 부담 무이자 할부                 | `불가능`                                                            |
| 다이렉트 호출                         | BC, 국민, 삼성, 신한, 현대, 롯데, 씨티, NH 그리고 하나 카드만 가능  |
| 다이렉트 호출 + 고정 할부 개월수      | BC, 국민, 삼성, 신한, 현대, 롯데, 씨티, NH 그리고 하나 카드만 가능  |
| 다이렉트 호출 + 리스트 할부 개월수    | 가능(단, `일시불이 항상 포함` 됨)                                   |
| 비 다이렉트 호출 + 고정 할부 개월수   | `단독 사용 불가능(다이렉트 호출 할 카드사 코드를 함께 전달해야 함)` |
| 비 다이렉트 호출 + 리스트 할부 개월수 | 가능(단, `일시불이 항상 포함` 됨)                                   |

### 결제 수단을 카드(`naverpay_point`) 또는 포인트(`naverpay_card`) 둘 중 하나로 무조건 선택해야 함

나이스페이 V2 네이버페이 결제시에는 네이버 페이 통합 결제창에서 카드와 포인트 둘 중 하나를 선택하는 방식이 아니고, 결제창을 띄울때부터 카드 결제창을 띄울 것인지 포인트 결제창을 띄울 것인지를 결제 수단에 명시해줘야 합니다. 따라서 결제 수단(`pay_method`) 파라미터에 `naverpay` 입력은 불가능하며 `naverpay_card` 또는 `naverpay_point` 둘 중 하나로 입력해야 합니다.

### 네이버페이 머니와 포인트 복합 결제시, 포인트가 먼저 사용 됨

네이버페이 포인트 결제시 네이버페이 머니, 포인트 또는 복합(머니와 포인트 함께 사용) 방식으로 결제가 가능한데 만약 복합 방식으로 결제할 경우 포인트 금액이 먼저 차감됩니다.

### 네이버페이 포인트 결제시 현금영수증 정보는 필수 입력

네이버페이 포인트 거래는 현금영수증 발급이 가능하므로 **현금영수증 정보는 필수 입력**입니다. 만약 입력하지 않을 경우 "나이스페이 V2 네이버페이 포인트 결제시 현금영수증 발급 유형은 필수 입력입니다."라는 에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.

### 네이버페이 머니로 결제시 현금영수증이 발급되지 않음

네이버페이 포인트 결제시 결제창에서 네이버페이 머니와 네이버페이 포인트 둘 중 하나로 선택해 결제가 가능한데, **네이버페이 머니로 결제할 경우에만 현금영수증이 발급**됩니다. 네이버페이 포인트로 결제하는 경우에는 결제창 호출시 현금영수증 정보를 전달하더라도 발급되지 않습니다.

# 페이코

| 기능                                  | 사용 가능 여부 |
| ------------------------------------- | -------------- |
| 상점 부담 무이자 할부                 | `불가능`       |
| 다이렉트 호출                         | 가능           |
| 다이렉트 호출 + 고정 할부 개월수      | 가능           |
| 다이렉트 호출 + 리스트 할부 개월수    | 가능           |
| 비 다이렉트 호출 + 고정 할부 개월수   | `불가능`       |
| 비 다이렉트 호출 + 리스트 할부 개월수 | 가능           |

# 삼성페이/SKPAY/SSGPAY

| 기능                                  | 사용 가능 여부 |
| ------------------------------------- | -------------- |
| 상점 부담 무이자 할부                 | 가능           |
| 다이렉트 호출                         | `불가능`       |
| 다이렉트 호출 + 고정 할부 개월수      | `불가능`       |
| 다이렉트 호출 + 리스트 할부 개월수    | `불가능`       |
| 비 다이렉트 호출 + 고정 할부 개월수   | `불가능`       |
| 비 다이렉트 호출 + 리스트 할부 개월수 | `불가능`       |

# 애플페이/LPAY

| 기능                                  | 사용 가능 여부 |
| ------------------------------------- | -------------- |
| 상점 부담 무이자 할부                 | `불가능`       |
| 다이렉트 호출                         | `불가능`       |
| 다이렉트 호출 + 고정 할부 개월수      | `불가능`       |
| 다이렉트 호출 + 리스트 할부 개월수    | `불가능`       |
| 비 다이렉트 호출 + 고정 할부 개월수   | `불가능`       |
| 비 다이렉트 호출 + 리스트 할부 개월수 | `불가능`       |

# SSG 은행계좌 결제

### SSGPAY 은행 계좌 결제시 주문 번호에 특수 문자는 허용되지 않음

SSGPAY 정책상 은행 계좌 결제시에는 **주문 번호(`merchant_uid`)에 특수 문자가 허용되지 않습니다.** 주문 번호에 특수문자 입력시 "나이스페이 V2 SSGPAY 은행 계좌 결제시 주문 번호에 특수문자는 허용되지 않습니다."와 같은 에러 메시지가 리턴되면서 결제창이 호출되지 않으니 참고 부탁드립니다.

### SSGPAY 은행 계좌 결제시 현금영수증 정보는 필수 입력

SSGPAY 은행 계좌 거래는 계좌에서 현금이 바로 빠져나가는 방식이기 때문에 현금영수증 발급이 가능하므로 **현금영수증 정보는 필수 입력**입니다. 만약 입력하지 않을 경우 "나이스페이 V2 SSGPAY 은행 계좌 결제시 현금영수증 발급 유형은 필수 입력입니다."라는 에러 메시지가 뜨면서 결제창이 호출되지 않으니 유의하시기 바랍니다.

### SSGPAY 은행 계좌 결제시 현금영수증 발급 정보를 확인할 수 없음

SSGPAY 은행 계좌 결제는 계좌에서 현금이 바로 빠져나가는 방식이기 때문에 현금영수증 발급이 가능합니다. 이를 위해서 결제창을 호출할때 현금영수증 정보를 아래와 같이 전달할 수 있는데요.

<Details>
<p slot="summary">파라미터 예시</p>

```javascript
IMP.request_pay({
  ...중략
  pg: 'nice_v2',
	pay_method: 'ssgpay_bank',
	bypass: {
		cashReceiptType: 'corporate', // 현금영수증 발급 유형(corporate: 지출증빙, personal: 소득공제)
		customerIdentifier: '1178178260' // 현금영수증 발행 식별 정보(사업자 등록번호 또는 휴대폰 번호)
	}
})
```

</Details>

단, 승인 완료(status: paid)시 나이스페이에서 **현금영수증 발급 정보를 전달해주지 않**기 때문에 API로 결제 건/현금영수증 발급 내역 조회 또는 V1 콘솔에서 현금영수증 내역 조회시 내역을 확인할 수 없습니다.

<Details>
<p slot="summary">결제내역 조회 API 호출 결과</p>

```javascript
// GET /payments/{imp_uid}

{
	...중략
	pay_method: 'trans',
	emb_pg_provider: 'ssgpay',
	pg: 'nice_v2',
	status: 'paid',
	cash_receipt_issued: false // 실제로는 현금영수즈이 발급 됐으나 포트원에 정보가 없으므로 false로 내려감
}
```

</Details>

<Details>
<p slot="summary">현금영수증 발급 내역 조회 API 호출 결과</p>

```javascript
// GET /receipts/{imp_uid}

{
  code: -1;
  message: "해당 아임포트 고유 번호({아임포트 번호})로 현금영수증을 발급 한 내역이 존재하지 않습니다.";
  data: null;
}
```

</Details>

<Details>
<p slot="summary">V1 콘솔 현금영수증 발급 내역</p>

import screenshot3 from "./_assets/caution/receipts-list-on-v1-console.png";

<Figure src={screenshot3} />

</Details>
그래도 나이스페이 관리자페이지에서는 확인할 수 있다고 하니 참고 부탁드립니다.

# 현금영수증

### 현금영수증 발급 유형이 소득 공제인 경우, 현금영수증 발급 유형은 휴대폰 번호만 가능하고 주민등록번호는 불가능

**계좌이체 다이렉트 호출, 네이버페이 포인트 결제, SSGPAY 은행 계좌 결제시 현금영수증 정보는 필수 입력**입니다. 단, 이때 현금영수증 발급 유형(`cashReceiptType`)이 소득 공제(`personal`)인 경우, 현금영수증 발급 유형(`customerIdentifier`)은 휴대폰 번호만 가능하며 주민등록번호 입력시 "현금영수증 식별 번호가 올바르지 않습니다."라는 에러 메시지가 리턴되며 결제창이 호출되지 않으니 유의하시기 바랍니다.

<Details>
<p slot="summary">파라미터 예시</p>

```javascript
IMP.request_pay({
	...중략
  pg: 'nice_v2',
  pay_method: 'naverpay_point', // 네이버페이 포인트 결제
	bypass: {
		cashReceiptType: 'personal', // 소득공제
		customerIdentifier: '01012345678', // 핸드폰 번호 입력(주민등록번호 불가능)
	}
}, 콜백 함수);
```

</Details>

참고로 결제창 가상계좌 발급, 계좌이체 비 다이렉트 호출시에는 현금영수증 정보를 파라미터로 전달할 수 없고(전달해도 결제창에 자동입력 되지 않음) 구매자가 결제창에 직접 입력해야 합니다.
