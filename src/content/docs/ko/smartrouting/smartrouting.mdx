---
title: 스마트 라우팅 연동하기
description: 스마트 라우팅 연동 방법을 안내합니다.
targetVersions: ["v2"]
---

import Details from "~/components/gitbook/Details.astro";
import Hint from "~/components/Hint.astro";
import ParamTree from "~/components/gitbook/ParamTree.astro";

<Hint style="info">
  스마트 라우팅 기능이 궁금하다면 [스마트 라우팅 기능 소개](../../smartrouting/smartrouting)를 확인해 보세요!

  스마트 라우팅을 이용하시려면 관리자콘솔에서 스마트 라우팅 그룹을 먼저 설정해야합니다.
  그룹 설정 방법이 궁금하다면 [스마트 라우팅 그룹 설정 가이드](../console/guide/smartrouting)를 확인해 보세요.
</Hint>

## SDK(결제창) 인증결제 연동하기

SDK를 이용하는 경우 결제 호출 시 생성한 스마트 라우팅 그룹의 ID를 전용 파라미터인 `channelGroupId`에
지정하여 사용이 가능합니다.
이 외에 다른 결제 기능들은 동일하게 사용이 가능합니다. 단, 결제대행사 별로 지원하는 기능이 다를 수 있으니
그룹 내에서 사용하는 모든 결제대행사에서 지원하는 기능만 사용하시길 권장드립니다.

인증결제와 관련된 자세한 내용은 [인증결제 연동하기](/docs/ko/authpay/guide) 문서를 참고하시기 바랍니다.

### 예제 코드

```tsx
PortOne.requestPayment({
  storeId: "store-4ff4af41-85e3-4559-8eb8-0d08a2c6ceec",

  // 결제대행사를 지정할 때 사용한 channelKey 대신
  // channelGroupId 파라미터에 스마트 라우팅 그룹 ID를 설정합니다.
  channelGroupId: "channel-group-live-f042e8e2-92f1-4f68-ad61-cec6ede41529",

  // 기타 인증결제 파라미터 설정
  paymentId: `payment-${crypto.randomUUID()}`,
  orderName: "나이키 와플 트레이너 2 SD",
  totalAmount: 1000,
  currency: "CURRENCY_KRW",
  payMethod: "CARD",

  // 스마트 라우팅 사용 시 필수 파라미터 추가 설정
  customer: {
    fullName: "홍길동",
    phoneNumber: "010-1234-5678",
    email: "test@test.com",
  },
});
```

### 주요 파라미터

**`channelGroupId`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

  **스마트 라우팅 그룹 ID**

  - 관리자 콘솔의 \[연동 관리] → \[스마트 라우팅] 메뉴에서 확인할 수 있습니다.

  - 스마트 라우팅 그룹 ID를 지정하여 결제창을 호출하면, 스마트 라우팅 그룹 내 설정된 채널 비율에 따라
  확률 기반으로 하나의 결제대행사가 호출됩니다.

### 필수 파라미터

각 파라미터에 대한 상세한 설명은 [결제요청 파라미터](/docs/ko/v2-payment/v2-sdk/payment-request)
문서를 참고하시기 바랍니다.

<ParamTree>
  - **`storeId`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **고객사 ID**

  - **`paymentId`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **고객사 주문 고유 번호**

  - **`orderName`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **주문명**

  - **`totalAmount`** <mark style="color:red;">**\***</mark> <mark style="color:purple;">**number**</mark>

    **결제 금액**

  - **`currency`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **결제 통화**

  - **`payMethod`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **결제수단 구분코드**

  - **`virtualAccount`** <mark style="color:blue;">**object**</mark>

    가상계좌 결제 사용 시 필요한 파라미터입니다.

    <ParamTree>
      - **`accountExpiry`** <mark style="color:red;">**\***</mark> <mark style="color:blue;">**object**</mark>

        **가상계좌 입금 만료기한**

        스마트 라우팅을 이용한 가상계좌 결제 사용 시 필수 입력해야 합니다.

        <ParamTree>
          - **`validHours`** <mark style="color:blue;">**number**</mark>

            **가상계좌 입금 유효 시간**

          - **`dueDate`** <mark style="color:blue;">**string**</mark>

            **가상계좌 입금 유효 시각**
        </ParamTree>
    </ParamTree>

  - **`easyPay`** <mark style="color:blue;">**object**</mark>

    **간편결제 정보**

    스마트 라우팅을 이용한 간편결제 다이렉트 호출 시 필수 입력해야 합니다.

    <ParamTree>
      - **`easyPayProvider`** <mark style="color:green;">**string**</mark>

        **간편결제 수단**
    </ParamTree>

  - **`productType`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

    **상품 유형**

    스마트 라우팅을 이용한 휴대폰 소액결제 사용 시 필수 입력해야 합니다.

  - **`customer`** <mark style="color:red;">**\***</mark> <mark style="color:blue;">**object**</mark>

    구매자 정보를 지정하는 파라미터입니다.

    <ParamTree>
      - **`fullName`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

        **구매자 전체 이름**

        `fullName` 파라미터 대신 `firstName`과 `lastName` 파라미터를 사용해도 됩니다.

      - **`phoneNumber`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

        **구매자 연락처**

      - **`email`** <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>

        **구매자 이메일 주소**
    </ParamTree>
</ParamTree>

### 유의사항

<Details>
  <Fragment slot="summary"> 스마트 라우팅 내 새로운 결제대행사 채널 추가 시 테스트 후 사용하시길 권장드립니다. </Fragment>

  결제대행사별로 결제 수단에 따라 필수 파라미터가 다르므로 그룹 내 새로운 결제대행사 추가 시 테스트 환경에서
  테스트를 진행한 후 실환경에 반영하시길 권장 드립니다.
  필수 파라미터 조건을 충족하지 못하는 경우 에러가 리턴되며, 결제창이 정상적으로 호출되지 않을 수 있습니다.

</Details>

<Details>
  <Fragment slot="summary"> 간편결제 사용을 원하시는 경우 허브형으로 사용하시길 권장드립니다. </Fragment>

  **간편결제 허브형을 사용하시는 경우**, 결제대행사 별 계약에 따라 결제창에 표시되는 간편결제가 상이할 수 있습니다.

  **간편결제 다이렉트 호출을 사용하시는 경우**, 결제대행사 별 계약에 따라 결제 호출 시 에러가 리턴되며 결제창이
호출되지 않을 수 있습니다. 가급적 결제대행사 별 동일한 간편결제 수단을 모두 계약하신 후 사용하시길 권장드립니다.

  단, **간편결제 직연동**의 경우 스마트 라우팅 기능을 제공하지 않습니다.

</Details>

## API 수기(키인)결제 연동하기

API를 이용하는 경우 결제 호출 시 생성한 스마트 라우팅 그룹의 ID를 전용 파라미터인 `channelGroupId`에
지정하여 사용이 가능합니다.
이 외에 다른 결제 기능들은 동일하게 사용이 가능합니다. 단, 결제대행사 별로 지원하는 기능이 다를 수 있으니
그룹 내에서 사용하는 모든 결제대행사에서 지원하는 기능만 사용하시길 권장드립니다.

수기(키인)결제와 관련된 자세한 내용은 [수기(키인)결제 연동하기](/docs/ko/v2-payment/key-in) 문서를 참고하시기 바랍니다.

### 예제 코드

```ts
  // 포트원 수기(키인)결제 API 호출
  const paymentResponse = await fetch(
    `https://api.portone.io/payments/${encodeURIComponent(UNIQUE_PAYMENT_ID)}/instant`,
    {
      method: "POST",
      headers: {
        Authorization: `PortOne ${PORTONE_API_SECRET}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        channelGroupId: "channel-group-test-94ab2b51-b7e1-4b74-9a9c-9fb6e117a6ac",
        orderName: "월간 이용권 정기결제",
        // 수기 결제 API를 참고해 고객 정보를 채워주세요.
        customer: YOUR_CUSTOMER_INFO,
        amount: {
          total: 8900,
        },
        currency: "KRW",
        // 수기(키인)결제 API를 참고해 카드 / 가상계좌 정보를 채워주세요.
        method: PAYMENT_METHOD_HERE,
      }),
    },
  );
  if (!paymentResponse.ok)
    throw new Error(`paymentResponse: ${paymentResponse.statusText}`);
  ```

### 주요 파라미터

### 필수 파라미터

### 유의사항


## API 빌링키 발급 및 정기결제 연동하기

### 예제 코드

### 주요 파라미터

### 필수 파라미터

### 유의사항

<Details>
  <Fragment slot="summary"> 빌링키 발급 요청 시 지정한 그룹 내 모든 채널로 빌링키를 발급합니다. </Fragment>

  그룹 내 채널을 활성화한 채로 비율을 0으로 설정한 경우 해당 채널로도 빌링키 발급을 요청합니다.
  빌링키 발급을 원하지 않는 경우 채널을 비활성화 상태로 두거나 그룹 내에서 삭제해야 합니다.

</Details>

<Details>
  <Fragment slot="summary"> 슈퍼 빌링키를 이용하여 결제 요청 시 불가피하게 그룹 내 비율이 0인 채널로 진행될 수 있습니다. </Fragment>

  슈퍼 빌링키를 이용하여 결제 요청했을 때, 슈퍼 빌링키에 맵핑된 결제대행사 빌링키 중 그룹 비율에 따라
  사용 가능한 빌링키가 없는 경우 그룹 내 채널 비율이 0으로 설정되어있더라도 해당 결제대행사로 결제가
  일어날 수 있습니다.

  예를 들어, 그룹 내에 나이스페이먼츠, 이니시스, 토스페이먼츠 총 3개의 결제대행사를 설정한 경우 빌링키
  발급 시 3개의 결제대행사로부터 빌링키를 발급 받은 후 슈퍼 빌링키에 맵핑 됩니다.
  이후 그룹 설정을 토스페이먼츠 0%, 스마트로 100%로 변경한 경우 위에 발급한 슈퍼 빌링키로 결제 요청 시
  토스페이먼츠 빌링키만 사용이 가능하기 때문에 0%로 결제 비율이 설정되어있음에도 토스페이먼츠로 결제가
  발생하게 됩니다.

</Details>
