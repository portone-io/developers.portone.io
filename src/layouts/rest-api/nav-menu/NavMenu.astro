---
import LeftSidebar from "~/layouts/sidebar/LeftSidebar.astro";
import NavMenuLink from "./NavMenuLink.astro";

export interface NavMenuItem {
  title: string;
  id: string;
  children?: NavMenuItem[];
}

interface Props {
  items: NavMenuItem[];
}
const { items } = Astro.props;
---

<script>
  import { sidebarOpenSignal } from "~/state/sidebar";
  const navMenu = document.getElementById("nav-menu");
  const navMenuItems = Array.from(navMenu?.querySelectorAll("a") || []);
  for (const item of navMenuItems) {
    item.addEventListener("click", (e) => {
      e.preventDefault();
      sidebarOpenSignal.value = false;
      document
        .getElementById(item.dataset.target || "")
        ?.scrollIntoView({ behavior: "smooth" });
      history.pushState({}, "", item.href);
    });
  }
</script>
<LeftSidebar>
  <nav
    id="nav-menu"
    class="text-slate-6 gap-12px flex h-full flex-col overflow-y-scroll p-2 pt-8 text-lg"
  >
    {
      items.map(({ id, title, children }) => (
        <div>
          <div class="hover:bg-slate-1 flex">
            <NavMenuLink id={id} title={title} />
            {children && children.length && (
              <button class="flex h-full items-center p-2">
                <i class="i-ic-baseline-keyboard-arrow-down inline-block" />
              </button>
            )}
          </div>
          {children && children.length && (
            <div class="flex flex-col pl-2 text-base">
              {children.map(({ id, title }) => (
                <div class="hover:bg-slate-1">
                  <NavMenuLink id={id} title={title} />
                </div>
              ))}
            </div>
          )}
        </div>
      ))
    }
  </nav>
</LeftSidebar>
